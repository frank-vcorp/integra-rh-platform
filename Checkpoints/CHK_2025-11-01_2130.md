# Checkpoint — 2025-11-01 21:30

Módulo/Componente: Integración de routers faltantes + Webhook + Actualización de plan

Resumen ejecutivo
- Se expusieron en el router activo las piezas que existían en el código pero no estaban cableadas (historial laboral, bitácora de candidato, integraciones de psicométricas y email), alineando el backend con la app inicial de raíz.
- Se añadió la ruta HTTP del webhook de Psicométricas.
- Se actualizó el backlog en PROYECTO.md para reflejar lo implementado y lo pendiente en UI.

Cambios aplicados (archivos clave)
- Nuevo: `integra-rh-manus/server/routers/workHistory.ts` — getByCandidate/create/update/delete.
- Nuevo: `integra-rh-manus/server/routers/candidateComments.ts` — getByCandidate/create.
- Nuevo: `integra-rh-manus/server/routers/psicometricas.ts` — asignarBateria/reenviarInvitacion/consultarResultados.
- Nuevo: `integra-rh-manus/server/routers/email.ts` — enviarInvitacionPsicometrica.
- Editado: `integra-rh-manus/server/routers/index.ts` — registra workHistory, candidateComments, psicometricas, email y clientAccess.
- Editado: `integra-rh-manus/server/_core/index.ts` — añade `POST /api/webhooks/psicometricas` (usa `handleWebhookPsicometricas`).
- Editado: `integra-rh-manus/.env.example` — agrega `PSICOMETRICAS_TOKEN`, `PSICOMETRICAS_PASSWORD`, `SENDGRID_API_KEY`.
- Editado: `PROYECTO.md` — marca DB Cloud SQL como hecha, añade y marca tareas de API; agrega pendientes de UI (historial, bitácora, psicométricas, email).

Requisitos de entorno
- Variables backend necesarias para integraciones:
  - `PSICOMETRICAS_TOKEN`, `PSICOMETRICAS_PASSWORD`, `SENDGRID_API_KEY`.
- Mantener `GOOGLE_APPLICATION_CREDENTIALS` para verificación de Firebase ID token.

Verificaciones sugeridas
- tRPC (autenticado):
  - `workHistory.getByCandidate`, `candidateComments.getByCandidate`.
  - `psicometricas.asignarBateria/reenviarInvitacion/consultarResultados` (requiere envs).
  - `email.enviarInvitacionPsicometrica` (requiere `SENDGRID_API_KEY`).
- Webhook: `POST /api/webhooks/psicometricas` con carga mock.

Notas
- Frontend pendiente: integrar las nuevas rutas en `CandidatoDetalle` para historial y bitácora; UI para Psicométricas y envío de invitaciones.
