# Checkpoint: Limpieza completa de Manus + Firebase estable (2025-11-02 22:15)

Resumen
- Código de Manus removido (OAuth SDK, rutas, UI, plugin Vite) y dependencias podadas.
- Autenticación Firebase-only funcionando: cliente adjunta Bearer ID token; servidor verifica con Admin.
- Firebase Admin sin ADC: inicialización con `FIREBASE_PROJECT_ID` y bucket.
- Login robusto con fallback a redirect y manejo de `getRedirectResult`.
- Documentación actualizada: `docs/AUTH_FIREBASE.md` (actual) y `docs/HISTORICO_MANUS.md` (histórico).
- Vite limitado a hosts locales; docs genéricos sin referencias activas a Manus.

Archivos clave tocados previamente
- Server
  - `server/firebase.ts`: inicialización Admin sin ADC + `projectId` explícito.
  - `server/_core/context.ts`: verifica `Authorization: Bearer <idToken>` y upsert de usuario.
  - `server/_core/env.ts`: poda de `appId`, `oAuthServerUrl`, `cookieSecret`.
  - Eliminados: `server/_core/sdk.ts`, `server/_core/oauth.ts`.
- Cliente
  - `client/src/pages/Login.tsx`: fallback redirect + `getRedirectResult`.
  - `client/src/main.tsx`: inyección de `Authorization` con `getIdToken()`.
  - `client/src/const.ts`: `getLoginUrl()` -> `"/login"`.
  - Eliminado: `client/src/components/ManusDialog.tsx`.
- Build
  - `vite.config.ts`: sin `vite-plugin-manus-runtime`; `allowedHosts` = localhost/127.0.0.1.
  - `package.json`: devDependency de Manus removida.
- Docs
  - Nuevos: `docs/AUTH_FIREBASE.md`, `docs/HISTORICO_MANUS.md`.
  - Genéricos ajustados: `docs/WORKFLOWS.md`, `docs/README.md`, `DOCUMENTACION_TECNICA.md`, `docs/DATABASE_DIAGRAM.md`.

Env esperado
- Servidor: `FIREBASE_PROJECT_ID`, `FIREBASE_STORAGE_BUCKET` (opcional), `DATABASE_URL`.
- Cliente: `VITE_API_URL`, `VITE_FIREBASE_*`, `VITE_APP_TITLE`, `VITE_APP_LOGO`.

Verificación rápida
1) `pnpm tsx watch ./server/_core/index.ts`
2) Abrir `http://localhost:3000` y login con Google.
3) Network: `/api/trpc/auth.me` responde 200 con `Authorization: Bearer <idToken>`.
4) Server: no aparece "Unable to detect a Project Id…".

Notas
- Para restaurar Manus, ver tag `checkpoint-2025-11-02-remove-manus` y `docs/HISTORICO_MANUS.md`.
