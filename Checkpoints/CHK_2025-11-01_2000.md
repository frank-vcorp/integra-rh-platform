
Dossier de Checkpoint: Integra-RH

ID del Checkpoint: 2025-11-01_2000

Módulo/Componente: PVM-WEB-02 - Login con Firebase Auth (Web)

Agente Principal: Gemini-Mentor

Tareas PROYECTO.md Asociadas:
- `[>]` PVM-WEB-02: Login con Firebase Auth

1. Resumen Ejecutivo (Para el Director de Proyecto)

Objetivo de la Sesión: Implementar un flujo de autenticación completo en el frontend utilizando Firebase Authentication (Google Sign-In), integrándolo con el backend de tRPC y protegiendo las rutas de la aplicación.

Estado al Finalizar: Completado. Los usuarios pueden iniciar y cerrar sesión. Las rutas principales están protegidas y solo son accesibles para usuarios autenticados.

2. Snapshot Técnico (Para Continuidad de IA)

2.1. Descripción Funcional

Se ha implementado la autenticación del lado del cliente. El flujo es el siguiente:
1. El usuario hace clic en "Sign in with Google" en la página de Login.
2. Se abre un popup de autenticación de Google gestionado por el SDK de Firebase.
3. Tras un login exitoso, el SDK de Firebase proporciona un ID Token.
4. Este token se adjunta automáticamente a todas las peticiones tRPC en la cabecera `Authorization`.
5. El backend verifica el token y, si es válido, establece el contexto de usuario.
6. El hook `useAuth` existente se actualiza, y la UI reacciona mostrando el estado de login y permitiendo el acceso a rutas protegidas.

2.2. Checklist de Tareas Técnicas Completadas

[✓] Creado `client/src/lib/firebase.ts` para la configuración del SDK de Firebase Web.
[✓] Solicitada al usuario la configuración de Firebase a través de variables de entorno `VITE_FIREBASE_*`.
[✓] Descartado el `AuthContext` personalizado al descubrir el hook `useAuth` existente.
[✓] Modificado `client/src/main.tsx` para inyectar dinámicamente el ID Token de Firebase en las cabeceras de las peticiones tRPC.
[✓] Actualizada la página `client/src/pages/Login.tsx` para manejar el flujo de `signInWithPopup` de Google.
[✓] Creado el componente `client/src/components/ProtectedRoute.tsx` para proteger rutas.
[✓] Modificado `client/src/App.tsx` para usar `ProtectedRoute` en las rutas del `DashboardLayout` y añadir la ruta `/login`.
[✓] Asegurado que el hook `useAuth` se actualice tras el login invalidando la query `auth.me`.

2.3. Archivos Clave Modificados o Creados

[CREATE]: `client/src/lib/firebase.ts`
[MODIFY]: `client/src/main.tsx`
[MODIFY]: `client/src/pages/Login.tsx`
[CREATE]: `client/src/components/ProtectedRoute.tsx`
[MODIFY]: `client/src/App.tsx`

3. Arquitectura y Contratos (Para Trabajo en Paralelo)

3.1. Dependencias Nuevas o Críticas

Ninguna. Se utilizaron las dependencias de `firebase` y `@trpc/client` ya existentes.

3.2. Estructuras de Datos / Modelos / Schemas

No se crearon nuevas estructuras de datos.

3.3. Interfaces y Contratos de API (Si aplica)

No se crearon nuevos endpoints. Se ha implementado el consumo del endpoint `auth.me` (`protectedProcedure`) desde el cliente, que ahora envía un `Bearer Token` de Firebase.

4. Estado y Próximos Pasos

4.1. Bloqueos y Decisiones Pendientes

Bloqueo: La funcionalidad completa depende de que el usuario configure correctamente las variables de entorno `VITE_FIREBASE_*` en el archivo `.env`.

Decisión Pendiente: Ninguna.

4.2. Contexto para Otros Módulos/Agentes

Para el Agente Frontend: La autenticación está lista. El estado del usuario (logueado o no) se puede consumir a través del hook `useAuth` desde `@/_core/hooks/useAuth`. Las páginas dentro de `DashboardLayout` son ahora privadas.

4.3. Siguientes Pasos para ESTE Módulo

- `[ ]` PVM-WEB-03: Listado de Clientes
