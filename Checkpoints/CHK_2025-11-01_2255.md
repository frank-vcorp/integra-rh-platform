# Checkpoint — 2025-11-01 22:55

Módulo/Componente: Detalle de Candidato + Procesos + Psicométricas + Documentos

Resumen ejecutivo
- Quedó operativa la pantalla de Detalle de Candidato con: historial laboral (CRUD + cálculo de tiempo), comentarios internos/públicos, documentos con subida a Firebase Storage (URL firmada) e íconos por tipo, Psicométricas (asignar por pruebas, reenviar invitación, consultar resultados JSON y guardar PDF/JSON en el expediente) y creación de procesos desde el candidato.
- Se añadió una vista mínima de Detalle de Proceso con datos y documentos asociados.

Cambios aplicados (principales)
- UI
  - `client/src/pages/CandidatoDetalle.tsx`: historial laboral, comentarios (visibility), documentos (upload + iconos), psico (asignar/reenviar/ver/guardar), procesos (listar y crear).
  - `client/src/pages/ProcesoDetalle.tsx`: nueva vista para detalle de proceso y documentos.
  - `client/src/App.tsx`: ruta `/procesos/:id`.
- API/Backend
  - `server/routers/workHistory.ts`, `candidateComments.ts`, `documents.ts`, `psicometricas.ts`, `candidates.ts`, `processes.ts`: routers activos registrados en `server/routers/index.ts`.
  - `server/integrations/psicometricas.ts`: adaptado a la API oficial (admin.psicometricas.mx) con agregaCandidato, consultaResultado, reenviarInvitacion, descarga PDF.
  - `server/routers/psicometricas.ts`: asignar por tests (CSV), persistencia de clave en candidato, guardar PDF en documentos.
  - `server/routers/documents.ts`: `upload` y `getByProcess`.
  - `server/_core/index.ts`: usa router modular `../routers/index` y mantiene webhook.
- DB/Esquema
  - `drizzle/schema.ts`: candidateComments.visibility (public/internal); documents.url/fileKey → TEXT para URLs largas. Migraciones aplicadas a integra_rh_v2.

Requisitos de entorno
- `GOOGLE_APPLICATION_CREDENTIALS` (Admin SDK JSON)
- `FIREBASE_STORAGE_BUCKET` y `VITE_FIREBASE_STORAGE_BUCKET` = `integra-rh.appspot.com`
- `PSICOMETRICAS_TOKEN`, `PSICOMETRICAS_PASSWORD` (API Psicométricas)
- `SENDGRID_API_KEY` para emails (si se usan)

Verificaciones sugeridas
- CandidatoDetalle:
  - Historial laboral: crear/editar/eliminar; ver tiempo calculado.
  - Comentarios: crear interno/público y ver filtro por rol (clientes ven sólo públicos).
  - Documentos: subir y abrir; ícono por extensión.
  - Psico: seleccionar pruebas, asignar; reenviar invitación; ver JSON; guardar PDF y resultados.
  - Procesos: crear desde candidato y ver listado.
- ProcesoDetalle: abrir `/procesos/:id` y ver datos + documentos.

Pendientes priorizados
- Psico: selector de baterías desde `/consultaBateria` (cacheado), actualizar estatus desde `/consultaCandidato`.
- Proceso: cambiar estatus, comentarios por proceso, subir documentos ligados al proceso.
- Documentos: eliminar/validaciones de tamaño/tipos.
- Seguridad por rol (en UI) y limpieza de mensajes.
