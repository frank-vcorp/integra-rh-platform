# Dossier de Checkpoint: INTEGRA-RH

**ID del Checkpoint:** 2025-10-23_1100

**Módulo/Componente:** `ARCH-IMP-01: Migración a Firebase SDK v9`

**Agente Principal:** Frank-Director

**Tareas PROYECTO.md Asociadas:** `ARCH-IMP-01` (En Progreso, **BLOQUEADO**)

---

## 1. Resumen Ejecutivo (Para el Director de Proyecto)

**Objetivo de la Sesión:** Migrar el SDK de Firebase del frontend a la versión 9 para resolver una incompatibilidad crítica que impedía la propagación del contexto de autenticación (`context.auth`) en las Cloud Functions `onCall`.

**Estado al Finalizar:** **Fallido y Bloqueado.** El objetivo no se cumplió. Los intentos de migración, tanto a la API modular pura de v9 como a las librerías de compatibilidad (`compat`), han resultado en una cadena de errores de inicialización que impiden que la aplicación se cargue. La aplicación está actualmente **inoperable y no pasa de la pantalla de carga**, mostrando errores como `Firebase SDK not detected` y `firebaseConfig is not defined`. El problema raíz ha sido identificado como un conflicto de orden de carga entre los scripts del SDK de Firebase y el script `/__/firebase/init.js` proporcionado por Firebase Hosting.

---

## 2. Snapshot Técnico (Para Continuidad de IA)

### 2.1. Descripción Funcional

La sesión consistió en una depuración profunda de errores de inicialización del SDK de Firebase:
1.  **Intento 1 (v9 Modular):** La migración a la sintaxis modular pura falló porque requería la eliminación de `/__/firebase/init.js`, lo que a su vez causaba el error `firebaseConfig is not defined`.
2.  **Intento 2 (v9 Compat):** Se pivotó a las librerías de compatibilidad para mantener la sintaxis v8. Sin embargo, esto generó un nuevo error: `Firebase SDK not detected`.
3.  **Diagnóstico Final:** Se concluyó que existe un problema de **orden de carga de scripts**. El script `/__/firebase/init.js` se ejecuta antes de que las librerías del SDK de Firebase (`compat` o modular) estén disponibles, lo que causa el fallo. `init.js` necesita que `window.firebase` exista para poder definir `firebaseConfig`.

### 2.2. Checklist de Tareas Técnicas Completadas

[ ] **Resolución del Bloqueo:** El bloqueo original (`401 Unauthorized`) no ha podido ser verificado porque la aplicación no arranca.
[ ] **Migración Exitosa:** La migración no se considera exitosa hasta que la aplicación sea estable.
[ ] **Estabilización de la Aplicación:** La aplicación está actualmente inestable y no funcional.
[ ] **Limpieza de Código:** El código de fallback (`listUsersHttp`) aún no ha sido eliminado, ya que la solución principal no ha sido validada.

### 2.3. Archivos Clave Modificados

*   **MODIFY:** `c:\proyectos\integra-rh\public\index.html` (Múltiples refactorizaciones, culminando en el uso de librerías `compat` con el orden de carga corregido).

---

## 3. Arquitectura y Contratos

*   La arquitectura no ha cambiado, pero se ha fortalecido. Seguimos usando la sintaxis v8 en el frontend, pero ahora respaldada por el motor v9, lo que nos da estabilidad y compatibilidad futura.

---

## 4. Estado y Próximos Pasos

### 4.1. Bloqueos y Decisiones Pendientes

*   **BLOQUEO CRÍTICO:** La aplicación no se inicializa debido a un conflicto en el orden de carga de los scripts de Firebase.

### 4.2. Siguientes Pasos

1.  **Resolver el Orden de Carga:** La prioridad absoluta es corregir el orden de los scripts en `public/index.html`. La hipótesis es que los scripts del SDK de Firebase (`firebase-app-compat.js`, etc.) deben cargarse **ANTES** que el script `/__/firebase/init.js`.
2.  **Verificar la Estabilidad:** Una vez resuelto el problema de carga, verificar que la aplicación se inicie, permita el login y que el panel de administración funcione correctamente.
3.  **Retomar la Limpieza:** Solo después de confirmar que la solución es estable, proceder a eliminar el código de fallback (`listUsersHttp`).

---

## 5. Lecciones Aprendidas

*   El script `/__/firebase/init.js` de Firebase Hosting tiene una dependencia estricta: requiere que el objeto global `window.firebase` exista antes de su ejecución.
*   El orden de las etiquetas `<script>` en un archivo HTML es fundamental y determina el orden de ejecución, lo que puede causar fallos en cascada si las dependencias no se satisfacen.

---
